#!/usr/bin/env sh

# Husky post-checkout hook
# Automatically updates package.json version when switching to a release branch

# Get the current branch name
BRANCH_NAME=$(git rev-parse --abbrev-ref HEAD)

# Check if we're on a release branch (release/x.x.x format)
if [[ $BRANCH_NAME =~ ^release/([0-9]+\.[0-9]+\.[0-9]+)$ ]]; then
  VERSION="${BASH_REMATCH[1]}"
  CURRENT_VERSION=$(node -p "require('./package.json').version" 2>/dev/null)

  # Only update if version is different
  if [ "$CURRENT_VERSION" != "$VERSION" ]; then
    echo "ðŸ“¦ Detected release branch: $BRANCH_NAME"
    echo "ðŸ”„ Updating package.json version: $CURRENT_VERSION â†’ $VERSION"

    # Update package.json version
    node -e "const fs=require('fs'); const pkg=JSON.parse(fs.readFileSync('package.json')); pkg.version='$VERSION'; fs.writeFileSync('package.json', JSON.stringify(pkg, null, 2) + '\n');"

    echo "âœ… package.json updated to version $VERSION"
  fi
fi
